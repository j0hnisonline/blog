<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Nginx-HTTP-Parse 文件解析漏洞 | \\Johnis.online\BLOG</title>
  <meta name="author" content="LonelyRain">
  
  <meta name="description" content="补丁分析CVE-2013-4547是Nginx出现过的一个解析漏洞，
官方的补丁打在了_ngx_httpparse.c上
123456789101112131415161718--- src/http/ngx_http_parse.c+++ src/http/ngx_http_parse.c@@ -617,6 +617,7 @@ ngx_http_parse_request_line(ngx_http_reqdefault:r-&amp;gt;space_in_uri = 1;state = sw_check_uri;+                p--;break;&amp;#125;break;@@ -670,6 +671,7 @@ ngx_http_parse_request_line(ngx_http_reqdefault:r-&amp;gt;space_in_uri = 1;state = sw_uri;+                p--;break;&amp;#125;break;">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Nginx-HTTP-Parse 文件解析漏洞"/>
  <meta property="og:site_name" content="\\Johnis.online\BLOG"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/old/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/old/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/old/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/old/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/old/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/old/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/old/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="/old//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/old/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cb5448498d7169c668b07c2b255d62c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/old/">\\Johnis.online\BLOG</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/old/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/old/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/old/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/old/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Nginx-HTTP-Parse 文件解析漏洞</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h2 id="补丁分析"><a href="#补丁分析" class="headerlink" title="补丁分析"></a>补丁分析</h2><p>CVE-2013-4547是Nginx出现过的一个解析漏洞，</p>
<p>官方的补丁打在了_ngx_http<em>parse.c</em>上</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">--- src/http/ngx_http_parse.c</div><div class="line">+++ src/http/ngx_http_parse.c</div><div class="line">@@ <span class="number">-617</span>,<span class="number">6</span> +<span class="number">617</span>,<span class="number">7</span> @@ ngx_http_parse_request_line(ngx_http_req</div><div class="line"><span class="keyword">default</span>:</div><div class="line">r-&gt;space_in_uri = <span class="number">1</span>;</div><div class="line">state = sw_check_uri;</div><div class="line">+                p--;</div><div class="line"><span class="keyword">break</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">break</span>;</div><div class="line">@@ <span class="number">-670</span>,<span class="number">6</span> +<span class="number">671</span>,<span class="number">7</span> @@ ngx_http_parse_request_line(ngx_http_req</div><div class="line"><span class="keyword">default</span>:</div><div class="line">r-&gt;space_in_uri = <span class="number">1</span>;</div><div class="line">state = sw_uri;</div><div class="line">+                p--;</div><div class="line"><span class="keyword">break</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">break</span>;</div></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="断点调试"><a href="#断点调试" class="headerlink" title="断点调试"></a>断点调试</h2><p>使用gdb调试nginx，将断点下在<code>/nginx-1.5.6/src/http/ngx_http_parse.c</code>的<code>ngx_http_parse_request_line</code>上，</p>
<p>发送了测试payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">GET /a.jpg /0.php HTTP/1.1</div><div class="line">Host: 127.0.0.1</div><div class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</div><div class="line">Upgrade-Insecure-Requests: 1</div><div class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.116 Safari/537.36</div><div class="line">Accept-Encoding: gzip, deflate, sdch</div><div class="line">Accept-Language: zh-CN,zh;q=0.8,en;q=0.6</div></pre></td></tr></table></figure>
<p><code>/a.jpg /0.php</code>中的空格是hex 00，非真正的空格</p>
<p>传入的http请求只接收到了<code>/a.jpg</code></p>
<p>ngx_http_parse_request_line传入了两个ngx_http_request_t类和ngx_buf_t类的指针，ngx_http_request_t在以下文件中定义了一个别名</p>
<p>文件:  _/src/http/ngx_http<em>request.h</em></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ngx_http_request_s</span>     <span class="title">ngx_http_request_t</span>;</span></div></pre></td></tr></table></figure>
<p>ngx_http_request_s的结构成员</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ngx_http_request_s</span> &#123;</span></div><div class="line"><span class="keyword">uint32_t</span>                          signature;         <span class="comment">/* "HTTP" */</span></div><div class="line"></div><div class="line"><span class="keyword">ngx_connection_t</span>                 *connection;</div><div class="line"></div><div class="line"><span class="keyword">void</span>                            **ctx;</div><div class="line"><span class="keyword">void</span>                            **main_conf;</div><div class="line"><span class="keyword">void</span>                            **srv_conf;</div><div class="line"><span class="keyword">void</span>                            **loc_conf;</div><div class="line"></div><div class="line">ngx_http_event_handler_pt         read_event_handler;</div><div class="line">ngx_http_event_handler_pt         write_event_handler;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> (NGX_HTTP_CACHE)</span></div><div class="line"><span class="keyword">ngx_http_cache_t</span>                 *cache;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="keyword">ngx_http_upstream_t</span>              *upstream;</div><div class="line"><span class="keyword">ngx_array_t</span>                      *upstream_states;</div><div class="line"><span class="comment">/* of ngx_http_upstream_state_t */</span></div><div class="line"></div><div class="line"><span class="keyword">ngx_pool_t</span>                       *pool;</div><div class="line"><span class="keyword">ngx_buf_t</span>                        *header_in;</div><div class="line"></div><div class="line"><span class="keyword">ngx_http_headers_in_t</span>             headers_in;</div><div class="line"><span class="keyword">ngx_http_headers_out_t</span>            headers_out;</div><div class="line"></div><div class="line"><span class="keyword">ngx_http_request_body_t</span>          *request_body;</div><div class="line"></div><div class="line"><span class="keyword">time_t</span>                            lingering_time;</div><div class="line"><span class="keyword">time_t</span>                            start_sec;</div><div class="line"><span class="keyword">ngx_msec_t</span>                        start_msec;</div><div class="line"></div><div class="line"><span class="keyword">ngx_uint_t</span>                        method;</div><div class="line"><span class="keyword">ngx_uint_t</span>                        http_version;</div><div class="line"></div><div class="line"><span class="keyword">ngx_str_t</span>                         request_line;</div><div class="line"><span class="keyword">ngx_str_t</span>                         uri;</div><div class="line"><span class="keyword">ngx_str_t</span>                         args;</div><div class="line"><span class="keyword">ngx_str_t</span>                         exten;</div><div class="line"><span class="keyword">ngx_str_t</span>                         unparsed_uri;</div><div class="line"></div><div class="line"><span class="keyword">ngx_str_t</span>                         method_name;</div><div class="line"><span class="keyword">ngx_str_t</span>                         http_protocol;</div><div class="line"></div><div class="line"><span class="keyword">ngx_chain_t</span>                      *out;</div><div class="line"><span class="keyword">ngx_http_request_t</span>               *main;</div><div class="line"><span class="keyword">ngx_http_request_t</span>               *parent;</div><div class="line"><span class="keyword">ngx_http_postponed_request_t</span>     *postponed;</div><div class="line"><span class="keyword">ngx_http_post_subrequest_t</span>       *post_subrequest;</div><div class="line"><span class="keyword">ngx_http_posted_request_t</span>        *posted_requests;</div><div class="line"></div><div class="line"><span class="keyword">ngx_int_t</span>                         phase_handler;</div><div class="line">ngx_http_handler_pt               content_handler;</div><div class="line"><span class="keyword">ngx_uint_t</span>                        access_code;</div><div class="line"></div><div class="line"><span class="keyword">ngx_http_variable_value_t</span>        *variables;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> (NGX_PCRE)</span></div><div class="line"><span class="keyword">ngx_uint_t</span>                        ncaptures;</div><div class="line"><span class="keyword">int</span>                              *captures;</div><div class="line">u_char                           *captures_data;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="keyword">size_t</span>                            limit_rate;</div><div class="line"><span class="keyword">size_t</span>                            limit_rate_after;</div><div class="line"></div><div class="line"><span class="comment">/* used to learn the Apache compatible response length without a header */</span></div><div class="line"><span class="keyword">size_t</span>                            header_size;</div><div class="line"></div><div class="line"><span class="keyword">off_t</span>                             request_length;</div><div class="line"></div><div class="line"><span class="keyword">ngx_uint_t</span>                        err_status;</div><div class="line"></div><div class="line"><span class="keyword">ngx_http_connection_t</span>            *http_connection;</div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> (NGX_HTTP_SPDY)</span></div><div class="line"><span class="keyword">ngx_http_spdy_stream_t</span>           *spdy_stream;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line">ngx_http_log_handler_pt           log_handler;</div><div class="line"></div><div class="line"><span class="keyword">ngx_http_cleanup_t</span>               *cleanup;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>                          subrequests:<span class="number">8</span>;</div><div class="line"><span class="keyword">unsigned</span>                          count:<span class="number">8</span>;</div><div class="line"><span class="keyword">unsigned</span>                          blocked:<span class="number">8</span>;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>                          aio:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>                          http_state:<span class="number">4</span>;</div><div class="line"></div><div class="line"><span class="comment">/* URI with "/." and on Win32 with "//" */</span></div><div class="line"><span class="keyword">unsigned</span>                          complex_uri:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="comment">/* URI with "%" */</span></div><div class="line"><span class="keyword">unsigned</span>                          quoted_uri:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="comment">/* URI with "+" */</span></div><div class="line"><span class="keyword">unsigned</span>                          plus_in_uri:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="comment">/* URI with " " */</span></div><div class="line"><span class="keyword">unsigned</span>                          space_in_uri:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>                          invalid_header:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>                          add_uri_to_alias:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          valid_location:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          valid_unparsed_uri:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          uri_changed:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          uri_changes:<span class="number">4</span>;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>                          request_body_in_single_buf:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          request_body_in_file_only:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          request_body_in_persistent_file:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          request_body_in_clean_file:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          request_body_file_group_access:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          request_body_file_log_level:<span class="number">3</span>;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>                          subrequest_in_memory:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          waited:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> (NGX_HTTP_CACHE)</span></div><div class="line"><span class="keyword">unsigned</span>                          cached:<span class="number">1</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> (NGX_HTTP_GZIP)</span></div><div class="line"><span class="keyword">unsigned</span>                          gzip_tested:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          gzip_ok:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          gzip_vary:<span class="number">1</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>                          proxy:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          bypass_cache:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          no_cache:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">* instead of using the request context data in</span></div><div class="line"><span class="comment">* ngx_http_limit_conn_module and ngx_http_limit_req_module</span></div><div class="line"><span class="comment">* we use the single bits in the request structure</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">unsigned</span>                          limit_conn_set:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          limit_req_set:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> 0</span></div><div class="line"><span class="keyword">unsigned</span>                          cacheable:<span class="number">1</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>                          pipeline:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          chunked:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          header_only:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          keepalive:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          lingering_close:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          discard_body:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          internal:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          error_page:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          ignore_content_encoding:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          filter_finalize:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          post_action:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          request_complete:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          request_output:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          header_sent:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          expect_tested:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          root_tested:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          done:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          logged:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>                          buffered:<span class="number">4</span>;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>                          main_filter_need_in_memory:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          filter_need_in_memory:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          filter_need_temporary:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          allow_ranges:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">if</span> (NGX_STAT_STUB)</span></div><div class="line"><span class="keyword">unsigned</span>                          stat_reading:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>                          stat_writing:<span class="number">1</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="comment">/* used to parse HTTP headers */</span></div><div class="line"></div><div class="line"><span class="keyword">ngx_uint_t</span>                        state;</div><div class="line"></div><div class="line"><span class="keyword">ngx_uint_t</span>                        header_hash;</div><div class="line"><span class="keyword">ngx_uint_t</span>                        lowcase_index;</div><div class="line">u_char                            lowcase_header[NGX_HTTP_LC_HEADER_LEN];</div><div class="line"></div><div class="line">u_char                           *header_name_start;</div><div class="line">u_char                           *header_name_end;</div><div class="line">u_char                           *header_start;</div><div class="line">u_char                           *header_end;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">* a memory that can be reused after parsing a request line</span></div><div class="line"><span class="comment">* via ngx_http_ephemeral_t</span></div><div class="line"><span class="comment">*/</span></div><div class="line"></div><div class="line">u_char                           *uri_start;</div><div class="line">u_char                           *uri_end;</div><div class="line">u_char                           *uri_ext;</div><div class="line">u_char                           *args_start;</div><div class="line">u_char                           *request_start;</div><div class="line">u_char                           *request_end;</div><div class="line">u_char                           *method_end;</div><div class="line">u_char                           *schema_start;</div><div class="line">u_char                           *schema_end;</div><div class="line">u_char                           *host_start;</div><div class="line">u_char                           *host_end;</div><div class="line">u_char                           *port_start;</div><div class="line">u_char                           *port_end;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>                          http_minor:<span class="number">16</span>;</div><div class="line"><span class="keyword">unsigned</span>                          http_major:<span class="number">16</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>我们接下来再看一下ngx_buf_t类的结构成员</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ngx_buf_s</span>  <span class="title">ngx_buf_t</span>;</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ngx_buf_s</span> &#123;</span></div><div class="line">u_char          *pos;</div><div class="line">u_char          *last;</div><div class="line"><span class="keyword">off_t</span>            file_pos;</div><div class="line"><span class="keyword">off_t</span>            file_last;</div><div class="line"></div><div class="line">u_char          *start;         <span class="comment">/* start of buffer */</span></div><div class="line">u_char          *end;           <span class="comment">/* end of buffer */</span></div><div class="line"><span class="keyword">ngx_buf_tag_t</span>    tag;</div><div class="line"><span class="keyword">ngx_file_t</span>      *file;</div><div class="line"><span class="keyword">ngx_buf_t</span>       *shadow;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/* the buf's content could be changed */</span></div><div class="line"><span class="keyword">unsigned</span>         temporary:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">* the buf's content is in a memory cache or in a read only memory</span></div><div class="line"><span class="comment">* and must not be changed</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">unsigned</span>         memory:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="comment">/* the buf's content is mmap()ed and must not be changed */</span></div><div class="line"><span class="keyword">unsigned</span>         mmap:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>         recycled:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>         in_file:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>         flush:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>         sync:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>         last_buf:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>         last_in_chain:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span>         last_shadow:<span class="number">1</span>;</div><div class="line"><span class="keyword">unsigned</span>         temp_file:<span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="comment">/* STUB */</span> <span class="keyword">int</span>   num;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>结构成员名字的含义：</p>
<table>
<thead>
<tr>
<th>pos:</th>
<th style="text-align:center">当buf所指向的数据在内存里的时候，pos指向的是这段数据开始的位置。</th>
</tr>
</thead>
<tbody>
<tr>
<td>last:</td>
<td style="text-align:center">当buf所指向的数据在内存里的时候，last指向的是这段数据结束的位置。</td>
</tr>
<tr>
<td>file_pos:</td>
<td style="text-align:center">当buf所指向的数据是在文件里的时候，file_pos指向的是这段数据的开始位置在文件中的偏移量。</td>
</tr>
<tr>
<td>file_last:</td>
<td style="text-align:center">当buf所指向的数据是在文件里的时候，file_last指向的是这段数据的结束位置在文件中的偏移量。</td>
</tr>
<tr>
<td>start:</td>
<td style="text-align:center">当buf所指向的数据在内存里的时候，这一整块内存包含的内容可能被包含在多个buf中(比如在某段数据中间插入了其他的数据，这一块数据就需要被拆分开)。那么这些buf中的start和end都指向这一块内存的开始地址和结束地址。而pos和last指向本buf所实际包含的数据的开始和结尾。</td>
</tr>
<tr>
<td>end:</td>
<td style="text-align:center">解释参见start。</td>
</tr>
<tr>
<td>tag:</td>
<td style="text-align:center">实际上是一个void*类型的指针，使用者可以关联任意的对象上去，只要对使用者有意义。</td>
</tr>
<tr>
<td>file:</td>
<td style="text-align:center">当buf所包含的内容在文件中时，file字段指向对应的文件对象。</td>
</tr>
<tr>
<td>shadow:</td>
<td style="text-align:center">当这个buf完整copy了另外一个buf的所有字段的时候，那么这两个buf指向的实际上是同一块内存，或者是同一个文件的同一部分，此时这两个buf的shadow字段都是指向对方的。那么对于这样的两个buf，在释放的时候，就需要使用者特别小心，具体是由哪里释放，要提前考虑好，如果造成资源的多次释放，可能会造成程序崩溃！</td>
</tr>
<tr>
<td>temporary:</td>
<td style="text-align:center">为1时表示该buf所包含的内容是在一个用户创建的内存块中，并且可以被在filter处理的过程中进行变更，而不会造成问题。</td>
</tr>
<tr>
<td>memory:</td>
<td style="text-align:center">为1时表示该buf所包含的内容是在内存中，但是这些内容却不能被进行处理的filter进行变更。</td>
</tr>
<tr>
<td>mmap:</td>
<td style="text-align:center">为1时表示该buf所包含的内容是在内存中, 是通过mmap使用内存映射从文件中映射到内存中的，这些内容却不能被进行处理的filter进行变更。</td>
</tr>
<tr>
<td>recycled:</td>
<td style="text-align:center">可以回收的。也就是这个buf是可以被释放的。这个字段通常是配合shadow字段一起使用的，对于使用ngx_create_temp_buf 函数创建的buf，并且是另外一个buf的shadow，那么可以使用这个字段来标示这个buf是可以被释放的。</td>
</tr>
<tr>
<td>in_file:</td>
<td style="text-align:center">为1时表示该buf所包含的内容是在文件中。</td>
</tr>
<tr>
<td>flush:</td>
<td style="text-align:center">遇到有flush字段被设置为1的的buf的chain，则该chain的数据即便不是最后结束的数据（last_buf被设置，标志所有要输出的内容都完了），也会进行输出，不会受postpone_output配置的限制，但是会受到发送速率等其他条件的限制。</td>
</tr>
<tr>
<td>sync:</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>last_buf:</td>
<td style="text-align:center">数据被以多个chain传递给了过滤器，此字段为1表明这是最后一个buf。</td>
</tr>
<tr>
<td>last_in_chain:</td>
<td style="text-align:center">在当前的chain里面，此buf是最后一个。特别要注意的是last_in_chain的buf不一定是last_buf，但是last_buf的buf一定是last_in_chain的。这是因为数据会被以多个chain传递给某个filter模块。</td>
</tr>
<tr>
<td>last_shadow:</td>
<td style="text-align:center">在创建一个buf的shadow的时候，通常将新创建的一个buf的last_shadow置为1。</td>
</tr>
<tr>
<td>temp_file:</td>
<td style="text-align:center">由于受到内存使用的限制，有时候一些buf的内容需要被写到磁盘上的临时文件中去，那么这时，就设置此标志 。</td>
</tr>
</tbody>
</table>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">line：<span class="number">109</span></div><div class="line"><span class="keyword">enum</span> &#123;</div><div class="line">sw_start = <span class="number">0</span>,</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>定义了一个状态机，通过state的值来确定处理步骤。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">line：139 state = r-&gt;state;</div></pre></td></tr></table></figure>
<p>state被赋值为r-&gt;state，r-&gt;state的类型为ngx_uint_t，ngx_uint_t类型是在以下文件中声明的</p>
<p>文件：_src/core/ngx<em>config.h</em></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">uintptr_t</span>       <span class="keyword">ngx_uint_t</span>;</div></pre></td></tr></table></figure>
<p>而uintptr_t类型的话，在Mac OS X中是在</p>
<p><code>_/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk/usr/include/sys/_types/_uintptr_t.h_</code></p>
<p>中被声明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span>        <span class="keyword">uintptr_t</span>;</div></pre></td></tr></table></figure>
<p>可以看出uintptr_t类型实际上就是一个unsigned long类型，在<strong>《深入分析Linux内核源码》</strong>中的原因描述是这样的，</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">尽管在混合不同数据类型时你必须小心, 有时有很好的理由这样做. 一种情况是因为内存存取, 与内核相关时是特殊的. 概念上, 尽管地址是指针, 内存管理常常使用一个无符号的整数类型更好地完成; 内核对待物理内存如同一个大数组, 并且内存地址只是一个数组索引. 进一步地, 一个指针容易解引用; 当直接处理内存存取时, 你几乎从不想以这种方式解引用. 使用一个整数类型避免了这种解引用, 因此避免了 bug. 因此, 内核中通常的内存地址常常是 unsigned long, 利用了指针和长整型一直是相同大小的这个事实, 至少在 Linux 目前支持的所有平台上.</div><div class="line"></div><div class="line">因为其所值的原因, C99 标准定义了 intptr<span class="emphasis">_t 和 uintptr_</span>t 类型给一个可以持有一个指针值的整型变量. 但是, 这些类型几乎没在 2.6 内核中使用</div></pre></td></tr></table></figure>
<p>进行验证：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> a;</div><div class="line"><span class="keyword">int</span> *b;</div><div class="line"><span class="built_in">printf</span>(<span class="string">"%d %d"</span>, <span class="keyword">sizeof</span>(a), <span class="keyword">sizeof</span>(b));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="number">8</span> <span class="number">8</span></div><div class="line">Process finished with <span class="built_in">exit</span> code <span class="number">0</span></div></pre></td></tr></table></figure>
<p>​    接下来进入了for循环里面，for循环里面的p的开始和结束分别为buff在内存中的开始(pos)和结束(last)。b-&gt;pos和b-&gt;last的类型是u_char,u<em>char是在MacOSX在</em>/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk/usr/include/sys/types.h_中定义的。<br>​<br>​    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">​    line：84 typedef unsigned char     u_char;</div><div class="line">​</div></pre></td></tr></table></figure></p>
<p>​<br>​    所以pos和last分别储存了buff开始和结束的unsigned类型的两个字符。<br>​<br>​    <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">​    line：<span class="number">141</span> <span class="keyword">for</span> (p = b-&gt;pos; p &lt; b-&gt;last; p++)&#123;...&#125;</div><div class="line">​</div></pre></td></tr></table></figure></p>
<p>​<br>​    接着使用了一个for循环来控制指针的移动，ch为当前指针指向的字符。r-&gt;state的值为0<br>​<br>​    ，所以第一次进入状态机进入了sw_start，如果第一个字符是CR（回车）或者LF（换行）就break，接下去再把指针p向后移动直到碰到非LF和CR，再进入下一个判断语句<br>​<br>​    <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">​    <span class="keyword">if</span> ((ch &lt; <span class="string">'A'</span> || ch &gt; <span class="string">'Z'</span>) &amp;&amp; ch != <span class="string">'_'</span>) &#123;</div><div class="line">​    <span class="keyword">return</span> NGX_HTTP_PARSE_INVALID_METHOD;</div><div class="line">​    &#125;</div><div class="line">​</div></pre></td></tr></table></figure></p>
<p>​<br>​    遇到A-Z和_之外的字符都返回一个解析错误。通过了这两项检查，会向后移动直到遇到一个空格，会进入method的判断，开发人员先判断了遇到的第一个空格之前字符的数量，根据数量再进入相应的case中去判断是什么method然后再将r-&gt;method设置为相应的method。<br>​<br>​    完成了以上对HTTP method的判断之后，进入了第二个判断sw_spaces_before_uri，<br>​<br>​    <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">​    <span class="keyword">switch</span> (ch) &#123;</div><div class="line">​    <span class="keyword">case</span> <span class="string">' '</span>:</div><div class="line">​    <span class="keyword">break</span>;</div><div class="line">​    <span class="keyword">default</span>:</div><div class="line">​    <span class="keyword">return</span> NGX_HTTP_PARSE_INVALID_REQUEST;</div><div class="line">​    &#125;</div><div class="line">​</div></pre></td></tr></table></figure></p>
<p>​<br>​    这一段我们可以看出，只要遇到空格（space）指针就会就会往后移动，直到遇到’/‘或者遇到字符A-Z。<br>​<br>​    <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">​    c = (u_char) (ch | <span class="number">0x20</span>);</div><div class="line">​    <span class="keyword">if</span> (c &gt;= <span class="string">'a'</span> &amp;&amp; c &lt;= <span class="string">'z'</span>) &#123;</div><div class="line">​    r-&gt;schema_start = p;</div><div class="line">​    state = sw_schema;</div><div class="line">​    <span class="keyword">break</span>;</div><div class="line">​    &#125;</div><div class="line">​</div></pre></td></tr></table></figure></p>
<p>​<br>​    代码就是判断是否是sw_host_start，不是sw_host_start就判别为uri的开始，如果在<code>:</code>后碰到两个<code>/</code>并且如果<code>[</code>就进行ipv6的判断。<br>​<br>​    文字看起来没有图像直观，以下是解析的流程图<img src="/old/2017/10/10/Nginx-HTTP-Parse-Vulnerability/1509484404.png" alt="nginx_http0.png"><br>​<br>​    在sw_uri之后放置空格，case会进入sw_check_uri_http_09，这时候uri_ext和uri_end之间的值为Nginx判断的后缀，即如果让nginx解析的是以下的连接<br>​<br>​    <code>http://www.Johnis.online/1.jpg[空格][零零]1.php</code><br>​<br>​    那么nginx会判定为<code>jpg</code>，到了case <code>sw_check_uri_http_09</code>中，遇到/00并不会进行处理,会使用default条件<br>​<br>​    <img src="/old/2017/10/10/Nginx-HTTP-Parse-Vulnerability/2972208958.png" alt="nginx_http_1.png"><br>​<br>​    <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">​    <span class="keyword">default</span>:</div><div class="line">​    r-&gt;space_in_uri = <span class="number">1</span>;</div><div class="line">​    state = sw_check_uri;</div><div class="line">​    <span class="keyword">break</span>;</div><div class="line">​</div></pre></td></tr></table></figure></p>
<p>​<br>​    <img src="/old/2017/10/10/Nginx-HTTP-Parse-Vulnerability/1509484404.png" alt="nginx_gdb_1.png"><br>​<br>​    成功的没有让nginx对/00进行处理。<br>​<br>​    而后面.php成功的将<code>uri_ext</code>覆盖为了<code>php</code>，之后 nginx 就会将请求发送给 <code>fastcgi</code> 去解析，<code>fastcgi</code>查找文件会被00阻断［这里代码找不到，留个坑］，于是漏洞就形成了。<br>​<br>​    <img src="/old/2017/10/10/Nginx-HTTP-Parse-Vulnerability/2565879554.png" alt="nginx_burp.png"><br>​<br>​    注意点就是jpg文件上传的时候必须带一个空格，触发的时候空格后面加一个00跟上.php就能触发了［security.limit_extensions没有限制的情况下］<br>​<br>​    Reference:<br>​<br>​    <a href="http://tengine.taobao.org/book/" target="_blank" rel="external">taobao,(2013)._nginx开发从入门到精通</a><br>​<br>​    <a href="http://blog.csdn.net/liujiyong7/article/details/44833475" target="_blank" rel="external">囧囧有神,(2015)._nginx源码分析之http解码实现</a></p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/old/2017/10/10/Imagetragick/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/old/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/old/2017/10/10/新博客-新旅程/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	
<section id="comment">
    <h2 class="title">Comments</h2>

    
    <div id="disqus_thread" class="ds-thread">
        <script type="text/javascript">
            /**
             * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
             * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
             */
                /*
                 var disqus_config = function () {
                 this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                 this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                 };
                 */
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');

                s.src = '//lonelyrain-1.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="/old//disqus.com/?ref_noscript">comments powered by
                Disqus.</a></noscript>
    </div>
    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2017-10-10 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/old/categories/漏洞分析/">漏洞分析<span>13</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/old/tags/漏洞分析/">漏洞分析<span>12</span></a></li> <li><a href="/old/tags/Nginx/">Nginx<span>1</span></a></li> <li><a href="/old/tags/解析漏洞/">解析漏洞<span>1</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#补丁分析"><span class="toc-article-text">补丁分析</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#断点调试"><span class="toc-article-text">断点调试</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->

<script type="text/javascript">
var disqus_shortname = 'lonelyrain-1';
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2019 LonelyRain
  
</p>

<script>
  var disqus_shortname = 'lonelyrain-1';
  
  var disqus_url = 'http://cnlonelyrain.github.io/2017/10/10/Nginx-HTTP-Parse-Vulnerability/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/old/js/jquery.imagesloaded.min.js"></script>
<script src="/old/js/gallery.js"></script>
<script src="/old/js/bootstrap.min.js"></script>
<script src="/old/js/main.js"></script>
<script src="/old/js/search.js"></script> 


<link rel="stylesheet" href="/old/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/old/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "old/search.xml";
	 if (search_path.length == 0) {
	 	search_path = "old/search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
